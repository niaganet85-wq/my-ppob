<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADMIN PANEL</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>.hidden{display:none}</style>
</head>
<body class="bg-gray-900 text-white min-h-screen font-sans">
    <div id="login" class="fixed inset-0 flex items-center justify-center bg-gray-900 z-50">
        <div class="bg-gray-800 p-8 rounded-xl w-80 text-center border border-gray-700">
            <h2 class="text-xl font-bold mb-4 text-blue-500">LOGIN ADMIN</h2>
            <input type="password" id="pin" class="w-full bg-gray-700 p-3 rounded mb-4 text-center text-xl" placeholder="PIN" maxlength="6">
            <button onclick="auth()" class="w-full bg-blue-600 py-3 rounded font-bold">MASUK</button>
        </div>
    </div>
    <div id="panel" class="hidden">
        <div class="bg-blue-600 p-6 rounded-b-3xl shadow-lg mb-6">
            <div class="flex justify-between items-center mb-4">
                <h1 class="font-black italic text-xl">DASHBOARD</h1>
                <button onclick="load('cek_saldo')" class="bg-white/20 p-2 rounded-full"><i class="fas fa-sync-alt"></i></button>
            </div>
            <div class="grid grid-cols-2 gap-4">
                <div class="bg-black/20 p-4 rounded-xl"><p class="text-xs opacity-70">SALDO DIGI</p><h2 id="saldo" class="text-lg font-bold">Rp 0</h2></div>
                <div class="bg-black/20 p-4 rounded-xl"><p class="text-xs opacity-70">LABA HARI INI</p><h2 id="laba" class="text-lg font-bold text-yellow-400">Rp 0</h2></div>
            </div>
        </div>
        <div class="px-4 space-y-3 pb-20">
            <div class="flex gap-2">
                <button onclick="load('riwayat')" class="flex-1 bg-gray-800 py-2 rounded text-xs font-bold border border-gray-700">RIWAYAT</button>
                <button onclick="viewHarga()" class="flex-1 bg-yellow-600 py-2 rounded text-xs font-bold">CEK HARGA</button>
            </div>
            <div id="list" class="space-y-2"></div>
        </div>
    </div>
    <div id="modal-harga" class="hidden fixed inset-0 bg-gray-900 z-40 p-4 flex flex-col">
        <div class="flex justify-between mb-4"><h3 class="font-bold text-yellow-500">DAFTAR HARGA</h3><button onclick="document.getElementById('modal-harga').classList.add('hidden')" class="text-red-500">Tutup</button></div>
        <input type="text" id="cari" onkeyup="cariHarga()" class="bg-gray-800 p-3 rounded mb-2 w-full" placeholder="Cari Produk...">
        <div id="list-harga" class="flex-1 overflow-y-auto text-xs space-y-2"></div>
    </div>

    <script>
        const PIN="753357"; let dbHarga=[];
        function auth(){ if(document.getElementById('pin').value===PIN){document.getElementById('login').classList.add('hidden');document.getElementById('panel').classList.remove('hidden');load('cek_saldo');load('riwayat');}else{alert("PIN SALAH");} }
        async function load(act){
            try{
                const r=await fetch('/api/digi',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({action:act})});
                const d=await r.json();
                if(act==='cek_saldo')document.getElementById('saldo').innerText="Rp "+(d.data?.deposit||0).toLocaleString('id-ID');
                if(act==='riwayat'){
                    const s=(d.data||[]).filter(i=>i.status==='Sukses').length;
                    document.getElementById('laba').innerText="Rp "+(s*250).toLocaleString('id-ID');
                    document.getElementById('list').innerHTML=(d.data||[]).map(i=>`<div class="bg-gray-800 p-3 rounded border border-gray-700 flex justify-between"><div><p class="text-blue-400 font-bold text-xs">${i.buyer_sku_code}</p><p class="text-[10px]">${i.customer_no}</p></div><p class="text-xs ${i.status==='Sukses'?'text-green-400':'text-red-400'}">${i.status}</p></div>`).join('');
                }
                if(act==='harga'){dbHarga=d.data||[];document.getElementById('list-harga').innerHTML="<p class='text-center mt-4'>Data Siap.</p>";}
            }catch(e){}
        }
        function viewHarga(){document.getElementById('modal-harga').classList.remove('hidden');load('harga');}
        function cariHarga(){
            const k=document.getElementById('cari').value.toLowerCase();
            document.getElementById('list-harga').innerHTML=dbHarga.filter(i=>i.product_name.toLowerCase().includes(k)&&i.buyer_product_status).map(i=>`<div class="bg-gray-800 p-2 rounded flex justify-between"><span>${i.product_name}</span><span class="text-green-400 font-bold">Rp ${i.price.toLocaleString()}</span></div>`).join('');
        }
    </script>
</body>
</html>
